<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Extracteur Noms/Prénoms</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    textarea, #result { width: 100%; }
    textarea { height: 150px; margin-bottom: 10px; }
    button { padding: 10px 20px; cursor: pointer; margin: 5px 0; }
    #result { margin-top: 20px; padding: 10px; border: 1px solid #ccc; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h2>Convertisseur Noms (Excel/texte) → NOM Prénom</h2>

  <h3>Option 1 : Coller du texte</h3>
  <textarea id="input"></textarea><br>
  <button onclick="processText()">Convertir depuis le texte</button>

  <h3>Option 2 : Uploader un fichier CSV</h3>
  <input type="file" id="fileInput" accept=".csv">
  <button onclick="processFile()">Convertir depuis le fichier</button>

  <h3>Résultat :</h3>
  <div id="result"></div>

  <script>
    function cleanAndFormatName(line) {
      if (!line) return "";

      // Supprimer ce qui est entre parenthèses
      line = line.replace(/\(.*?\)/g, "").trim();

      // Découper
      let parts = line.split(/\s+/);

      if (parts.length < 2) return "";

      // Nom = tout sauf le dernier mot
      let nom = parts.slice(0, parts.length - 1).join(" ").toUpperCase();

      // Prénom = dernier mot
      let prenom = parts[parts.length - 1];
      prenom = prenom.charAt(0).toUpperCase() + prenom.slice(1).toLowerCase();

      return `${nom} ${prenom}`;
    }

    function processText() {
      const text = document.getElementById("input").value;
      const lines = text.split(/\r?\n/);

      // On prend seulement les lignes après "NOM" jusqu'à la première vide
      let startIndex = lines.findIndex(l => l.trim().toUpperCase() === "NOM");
      if (startIndex === -1) startIndex = 0;
      const participants = [];
      for (let i = startIndex + 1; i < lines.length; i++) {
        if (!lines[i].trim()) break;
        participants.push(lines[i]);
      }

      let names = participants.map(cleanAndFormatName).filter(n => n !== "");
      names = [...new Set(names)]; // Supprimer doublons

      document.getElementById("result").textContent = names.join(" ; ");
    }

    function processFile() {
      const file = document.getElementById("fileInput").files[0];
      if (!file) {
        alert("Merci de sélectionner un fichier CSV !");
        return;
      }

      Papa.parse(file, {
        complete: function(results) {
          const rows = results.data.map(r => r[0]); // On prend uniquement colonne A

          // Trouver "NOM" et commencer après
          let startIndex = rows.findIndex(r => r && r.trim().toUpperCase() === "NOM");
          if (startIndex === -1) startIndex = 0;

          const participants = [];
          for (let i = startIndex + 1; i < rows.length; i++) {
            if (!rows[i] || !rows[i].trim()) break;
            participants.push(rows[i]);
          }

          let names = participants.map(cleanAndFormatName).filter(n => n !== "");
          names = [...new Set(names)]; // Supprimer doublons
          document.getElementById("result").textContent = names.join(" ; ");
        }
      });
    }
  </script>
</body>
</html>
